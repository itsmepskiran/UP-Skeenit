<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skreenit - Registration</title>

  <link rel="icon" type="image/png" sizes="32x32" href="https://auth.skreenit.com/assets/images/favicon-32x32.png" />
  <link rel="stylesheet" href="https://auth.skreenit.com/assets/css/shared-styles.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <script>
    window.__SKREENIT_BACKEND_URL__ = 'https://aiskreenit.onrender.com';
    // Supabase configuration
    window.SKREENIT_SUPABASE_URL = 'https://gfkbqhniopgcaapolzbu.supabase.co';
    window.SKREENIT_SUPABASE_ANON_KEY = 'sb_publishable_ai0_qhGdNzNAUVabNOJT4g_rpGIGfqX';
  </script>
  <!-- Supabase Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<!-- Decorative elements (safe) -->
<div class="floating-elements" style="pointer-events:none;">
  <div class="floating-circle"></div>
  <div class="floating-circle"></div>
  <div class="floating-circle"></div>
  <div class="floating-circle"></div>
</div>

<a href="https://skreenit.com" class="logo-link">
  <img src="https://auth.skreenit.com/assets/images/logo.png" alt="Skreenit" />
</a>

<div class="auth-wrapper">
  <img src="https://auth.skreenit.com/assets/images/logobrand.png" class="brand-image" />

  <div class="auth-header">
    <h1><i class="fas fa-user-plus"></i> Join Skreenit</h1>
    <p>Create your account and start your journey</p>
  </div>

  <div class="auth-body">
    <div id="formError" class="error-message"></div>

    <form id="registrationForm">

      <!-- BASIC INFO -->
      <div class="form-row">
        <div class="form-group">
          <label>Full Name*</label>
          <input type="text" name="full_name" required />
        </div>
        <div class="form-group">
          <label>Mobile*</label>
          <input type="text" name="mobile" required />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Email*</label>
          <input type="email" name="email" required />
        </div>
        <div class="form-group">
          <label>Location*</label>
          <input type="text" name="location" required />
        </div>
      </div>

      <!-- ROLE -->
      <div class="form-group">
        <label>Register as*</label>
        <select id="role" name="role" required>
          <option value="">Select your role</option>
          <option value="candidate">üéØ Candidate</option>
          <option value="recruiter">üè¢ Recruiter</option>
        </select>
      </div>

      <!-- ROLE BASED FIELDS (HIDDEN INITIALLY) -->
      <div id="roleBasedFields" style="display:none;">

        <!-- Recruiter -->
        <div id="recruiterFields" class="hidden">
          <div class="form-group">
            <label>üè¢ Company Name*</label>
            <input type="text" name="company_name" />
          </div>
        </div>

        <!-- Candidate -->
        <div id="candidateFields" class="hidden">
          <div class="form-group">
            <label>üìÑ Resume</label>
            <input type="file" name="resume" />
            <div class="password-hint">Upload your resume for better matches</div>
          </div>
        </div>

      </div>

      <button type="submit" class="btn btn-primary btn-large" style="width:100%;">
        <i class="fas fa-rocket"></i> Create Account
      </button>

    </form>
  </div>
</div>

<!-- ROLE TOGGLE LOGIC -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const role = document.getElementById('role')
  const roleFields = document.getElementById('roleBasedFields')
  const recruiter = document.getElementById('recruiterFields')
  const candidate = document.getElementById('candidateFields')

  role.addEventListener('change', () => {
    if (!role.value) {
      roleFields.style.display = 'none'
      recruiter.classList.add('hidden')
      candidate.classList.add('hidden')
      return
    }

    roleFields.style.display = 'block'

    if (role.value === 'recruiter') {
      recruiter.classList.remove('hidden')
      candidate.classList.add('hidden')
    } else {
      candidate.classList.remove('hidden')
      recruiter.classList.add('hidden')
    }
  })
})
</script>

<!-- Registration Form Handler -->
<script type="module">
  document.addEventListener('DOMContentLoaded', async () => {
    const form = document.getElementById('registrationForm');
    const errorDiv = document.getElementById('formError');
    const roleSelect = document.getElementById('role');
    
    // Initialize Supabase client
    const { createClient } = supabase;
    const supabaseClient = createClient(
      window.SKREENIT_SUPABASE_URL,
      window.SKREENIT_SUPABASE_ANON_KEY
    );

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const userData = {
        email: formData.get('email'),
        password: generateTempPassword(), // You might want to implement this
        user_metadata: {
          full_name: formData.get('full_name'),
          mobile: formData.get('mobile'),
          location: formData.get('location'),
          role: roleSelect.value,
          ...(roleSelect.value === 'recruiter' && {
            company_name: formData.get('company_name')
          })
        }
      };

      try {
        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';

        // Sign up the user
        const { data, error } = await supabaseClient.auth.signUp({
          email: userData.email,
          password: userData.password,
          options: {
            data: userData.user_metadata,
            emailRedirectTo: `${window.location.origin}/login.html`
          }
        });

        if (error) throw error;

        // Show success message
        showMessage('Registration successful! Please check your email to verify your account.', 'success');
        form.reset();
        
        // Redirect to login after a short delay
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 3000);

      } catch (error) {
        console.error('Registration error:', error);
        showMessage(error.message || 'Registration failed. Please try again.', 'error');
      } finally {
        // Reset button state
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-rocket"></i> Create Account';
      }
    });

    // Helper function to show messages
    function showMessage(message, type = 'error') {
      errorDiv.textContent = message;
      errorDiv.className = `alert alert-${type}`;
      errorDiv.style.display = 'block';
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }

    // Helper function to generate a temporary password
    function generateTempPassword() {
      return Math.random().toString(36).slice(-8) + 'A1!';
    }
  });
</script>

</body>
</html>
