<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skreenit - Registration</title>

  <link rel="icon" type="image/png" sizes="32x32" href="https://auth.skreenit.com/assets/images/favicon-32x32.png" />
  <link rel="stylesheet" href="https://auth.skreenit.com/assets/css/shared-styles.css" />
  <link rel="stylesheet" href="https://auth.skreenit.com/assets/css/auth.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <style>
    .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
    .form-row .form-group { flex: 1; }
    .password-hint { font-size: 12px; color: #666; margin-top: 4px; }
    .auth-actions { text-align: center; margin-top: 20px; color: #666; }
    .auth-actions a { color: #1976d2; text-decoration: none; font-weight: 500; }
    .auth-actions a:hover { text-decoration: underline; }
    .form-group select {
      width: 100%; padding: 10px; border: 1px solid #ddd;
      border-radius: 4px; font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="floating-elements" style="pointer-events:none;">
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
  </div>

  <a href="https://skreenit.com" class="logo-link">
    <img src="https://auth.skreenit.com/assets/images/logo.png" alt="Skreenit" />
  </a>

  <div class="auth-wrapper">
    <img src="https://auth.skreenit.com/assets/images/logobrand.png" class="brand-image" />

    <div class="auth-header">
      <h1><i class="fas fa-user-plus"></i> Create an Account</h1>
      <p>Please enter your details to register</p>
    </div>

    <div class="auth-body">
      <div id="formError" class="error-message"></div>

      <form id="registrationForm">
        <div class="form-group">
          <label>Register as*</label>
          <select id="role" name="role" required>
            <option value="">Select your role</option>
            <option value="candidate">üë§ Candidate</option>
            <option value="recruiter">üè¢ Recruiter</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Full Name*</label>
            <input type="text" name="full_name" placeholder="Enter your name" required />
          </div>
          <div class="form-group">
            <label>Mobile*</label>
            <input type="tel" name="mobile" placeholder="Enter mobile number" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Email*</label>
            <input type="email" name="email" placeholder="Enter your email" required />
          </div>
          <div class="form-group">
            <label>Location*</label>
            <input type="text" name="location" placeholder="Enter location" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Password*</label>
            <div style="position: relative;">
              <input type="password" id="password" name="password" placeholder="Create password"
              minlength="8" required />
              <i class="fas fa-eye" style="position: absolute; right: 10px; top: 10px; cursor: pointer;"
                 onclick="togglePassword('password')"></i>
            </div>
            <div class="password-hint">
              8+ characters, with uppercase, lowercase, number & special character
            </div>
          </div>

          <div class="form-group">
            <label>Confirm Password*</label>
            <div style="position: relative;">
              <input type="password" id="confirmPassword" name="confirmPassword"
                     placeholder="Confirm password" required />
              <i class="fas fa-eye" style="position: absolute; right: 10px; top: 10px; cursor: pointer;"
                 onclick="togglePassword('confirmPassword')"></i>
            </div>
          </div>
        </div>

        <div class="form-footer" style="margin: 15px 0; text-align: center; font-size: 13px; color: #666;">
          By creating an account, you agree to our
          <a href="legal/terms-conditions.html" target="_blank">Terms & Conditions</a> and
          <a href="legal/privacy-policy.html" target="_blank">Privacy Policy</a>
        </div>

        <button type="submit" class="btn btn-primary btn-large" style="width:100%; margin-top: 10px;">
          <i class="fas fa-user-plus"></i> Create Account
        </button>

        <div class="auth-actions">
          Already have an account? <a href="login.html">Sign in</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Shared utilities -->
  <script type="module" src="https://auth.skreenit.com/assets/js/backend-client.js"></script>
  <script type="module" src="https://auth.skreenit.com/assets/js/supabase-config.js"></script>

  <!-- Embedded Registration Logic -->
  <script type="module">
    import { backendPost, handleResponse } from "https://auth.skreenit.com/assets/js/backend-client.js";

    function notify(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 5000);
    }

    async function handleRegistrationSubmit(event) {
      event.preventDefault();

      const form = event.target;
      const fd = new FormData(form);
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn?.textContent || 'Register';

      try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';

        const full_name = fd.get('full_name').trim();
        const email = fd.get('email').trim().toLowerCase();
        const mobile = fd.get('mobile').trim();
        const location = fd.get('location').trim();
        const role = fd.get('role').trim();
        const company_name = fd.get('company_name')?.trim();
        const resume = fd.get('resume');
        const password = fd.get('password').trim();

        if (!role || !['candidate', 'recruiter'].includes(role)) {
          throw new Error('Please select a valid role');
        }
        if (!full_name || !email || !mobile || !location) {
          throw new Error('Please fill in all required fields');
        }
        if (mobile.length < 7) {
          throw new Error('Please enter a valid mobile number');
        }

        const formData = new FormData();
        formData.append('full_name', full_name);
        formData.append('email', email);
        formData.append('password', password);
        formData.append('mobile', mobile);
        formData.append('location', location);
        formData.append('role', role);
        formData.append('email_redirect_to', 'https://login.skreenit.com/confirm-email');
        if (company_name) formData.append('company_name', company_name);
        if (resume) formData.append('resume', resume);

        const response = await backendPost('/auth/register', formData);
        const result = await handleResponse(response);

        if (!result?.ok) {
          throw new Error(result?.error || 'Registration failed');
        }

        document.querySelector('.auth-body').innerHTML = `
          <div class="text-center py-8">
            <div class="text-green-500 text-5xl mb-4">‚úì</div>
            <h2 class="text-2xl font-bold mb-2">Registration Successful!</h2>
            <p class="mb-4">Please check your email for a confirmation link.</p>
            <p class="text-sm text-gray-600">You'll be redirected to the login page shortly...</p>
          </div>
        `;

        setTimeout(() => {
          window.location.href = 'https://login.skreenit.com/login?registered=true';
        }, 3000);

      } catch (err) {
        notify(err.message || 'Registration failed. Please try again.', 'error');
      } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    }

    const form = document.getElementById("registrationForm");
    form.addEventListener("submit", handleRegistrationSubmit);
  </script>

</body>
</html>
